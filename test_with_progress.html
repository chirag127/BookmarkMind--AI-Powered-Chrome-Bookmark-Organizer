<!DOCTYPE html>
<html>

<head>
    <title>BookmarkMind Progress Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .progress-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4caf50;
            transition: width 0.3s ease;
        }

        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .success {
            background: #d4edda;
        }

        .error {
            background: #f8d7da;
        }

        .warning {
            background: #fff3cd;
        }
    </style>
</head>

<body>
    <h1>📊 BookmarkMind Progress Test</h1>

    <div class="progress-section">
        <h3>Categorization Progress</h3>
        <div class="progress-bar">
            <div id="progressFill" class="progress-fill" style="width: 0%"></div>
        </div>
        <p id="progressText">Ready to start...</p>
        <p id="progressDetails">Click start to begin categorization test</p>
    </div>

    <div class="progress-section">
        <button onclick="startTest()">Start Small Test (5 bookmarks)</button>
        <button onclick="startFullTest()">Start Full Test (All bookmarks)</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>

    <div class="progress-section">
        <h3>Live Log</h3>
        <div id="log" class="log">Waiting for test to start...</div>
    </div>

    <script>
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const progressDetails = document.getElementById('progressDetails');
        const log = document.getElementById('log');

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            log.textContent += logEntry;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        function updateProgress(stage, progress, details = '') {
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${stage} (${progress}%)`;
            progressDetails.textContent = details;
            addLog(`Progress: ${stage} - ${progress}% ${details}`);
        }

        async function startTest() {
            addLog('🔍 Starting small test with 5 bookmarks...');

            try {
                updateProgress('Starting', 0, 'Initializing test...');

                const response = await chrome.runtime.sendMessage({
                    action: 'startCategorization',
                    data: { forceReorganize: true, testMode: true, maxBookmarks: 5 }
                });

                if (response && response.success) {
                    updateProgress('Complete', 100, `Processed ${response.data.processed} bookmarks`);
                    addLog(`✅ Test successful! Processed: ${response.data.processed}, Categorized: ${response.data.categorized}`);
                } else {
                    addLog(`❌ Test failed: ${response?.error || 'No response'}`, 'error');
                }

            } catch (error) {
                addLog(`❌ Test error: ${error.message}`, 'error');
            }
        }

        async function startFullTest() {
            addLog('🔍 Starting full test with all bookmarks...');

            try {
                updateProgress('Starting', 0, 'Initializing full test...');

                const response = await chrome.runtime.sendMessage({
                    action: 'startCategorization',
                    data: { forceReorganize: true }
                });

                if (response && response.success) {
                    updateProgress('Complete', 100, `Processed ${response.data.processed} bookmarks`);
                    addLog(`✅ Full test successful! Processed: ${response.data.processed}, Categorized: ${response.data.categorized}`);
                } else {
                    addLog(`❌ Full test failed: ${response?.error || 'No response'}`, 'error');
                }

            } catch (error) {
                addLog(`❌ Full test error: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            log.textContent = 'Log cleared...\n';
        }

        // Listen for progress updates
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((message) => {
                if (message.action === 'categorizationProgress') {
                    const progress = message.data;
                    updateProgress(progress.stage, progress.progress, `Stage: ${progress.stage}`);
                }
            });
        }
    </script>
</body>

</html>