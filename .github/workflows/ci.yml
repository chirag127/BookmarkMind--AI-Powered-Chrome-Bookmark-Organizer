# Apex CI/CD Pipeline | BookmarkFlow-AI-Powered-Bookmark-Organizer-Browser-Extension
#---------------------------------------------------------------------------------------------------
# This workflow enforces the highest quality standards for every commit and pull request.
# It automates linting, testing, and building to ensure code integrity and readiness for deployment.
#---------------------------------------------------------------------------------------------------

name: 'CI: Lint, Test, and Build'

on:
  push:
    branches:
      - 'main'
  pull_request:
    branches:
      - 'main'
  workflow_dispatch: # Allows manual triggering

#--------------------------------------------------------------------
# CONCURRENCY & PERMISSIONS: Best practices for security and efficiency
#--------------------------------------------------------------------
permissions:
  contents: read # Read-only access to the repo for checkout

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

#--------------------------------------------------------------------
# JOBS: Define the sequential steps of the pipeline
#--------------------------------------------------------------------
jobs:
  build-and-test:
    name: 'Build & Test Extension'
    runs-on: ubuntu-latest

    steps:
      #----------------------------------------------------------------
      # STEP 1: CHECKOUT REPOSITORY
      #----------------------------------------------------------------
      - name: '1. Checkout Repository'
        uses: actions/checkout@v4

      #----------------------------------------------------------------
      # STEP 2: SETUP NODE.JS ENVIRONMENT (LTS)
      #----------------------------------------------------------------
      - name: '2. Setup Node.js Environment'
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
          cache-dependency-path: '**/package-lock.json'

      #----------------------------------------------------------------
      # STEP 3: INSTALL DEPENDENCIES
      #----------------------------------------------------------------
      - name: '3. Install Dependencies'
        run: npm ci

      #----------------------------------------------------------------
      # STEP 4: LINT & FORMAT CHECK
      #----------------------------------------------------------------
      - name: '4. Run Linter & Formatter Check'
        run: npm run lint

      #----------------------------------------------------------------
      # STEP 5: RUN UNIT & INTEGRATION TESTS
      #----------------------------------------------------------------
      - name: '5. Run Tests'
        run: npm run test

      #----------------------------------------------------------------
      # STEP 6: BUILD PRODUCTION ARTIFACTS
      #----------------------------------------------------------------
      - name: '6. Build Production Extension'
        run: npm run build

      #----------------------------------------------------------------
      # STEP 7: UPLOAD BUILD ARTIFACT
      #----------------------------------------------------------------
      - name: '7. Upload Build Artifact'
        uses: actions/upload-artifact@v4
        with:
          name: extension-build
          path: ./dist # Standard output directory for modern build tools
