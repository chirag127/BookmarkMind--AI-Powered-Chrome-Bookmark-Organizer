<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Test Groq Integration</title>
        <style>
            body {
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                max-width: 900px;
                margin: 50px auto;
                padding: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .container {
                background: white;
                padding: 30px;
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            }
            h1 {
                color: #333;
                margin-bottom: 30px;
            }
            .test-section {
                margin: 20px 0;
                padding: 20px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
            }
            .test-section h2 {
                color: #667eea;
                margin-top: 0;
            }
            button {
                background: #667eea;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 16px;
                margin: 5px;
            }
            button:hover {
                background: #5568d3;
            }
            button:disabled {
                background: #ccc;
                cursor: not-allowed;
            }
            .result {
                margin-top: 15px;
                padding: 15px;
                background: #f5f5f5;
                border-radius: 6px;
                font-family: monospace;
                white-space: pre-wrap;
            }
            .success {
                background: #d4edda;
                color: #155724;
            }
            .error {
                background: #f8d7da;
                color: #721c24;
            }
            input {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: 2px solid #e0e0e0;
                border-radius: 6px;
                font-size: 14px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>üöÄ Groq Integration Test</h1>

            <div class="test-section">
                <h2>1. Test Groq API Key</h2>
                <input
                    type="password"
                    id="groqApiKey"
                    placeholder="Enter your Groq API key (gsk_...)"
                />
                <button onclick="testGroqKey()">Test Groq API Key</button>
                <div
                    id="groqKeyResult"
                    class="result"
                    style="display: none"
                ></div>
            </div>

            <div class="test-section">
                <h2>2. Test Model Ordering</h2>
                <p>
                    Check that models are sorted by size descending across all
                    providers
                </p>
                <button onclick="testModelOrdering()">
                    Check Model Ordering
                </button>
                <div
                    id="modelOrderResult"
                    class="result"
                    style="display: none"
                ></div>
            </div>

            <div class="test-section">
                <h2>3. Test Fallback Logic</h2>
                <p>Simulate provider fallback with all three providers</p>
                <input
                    type="password"
                    id="geminiKey"
                    placeholder="Gemini API key (AIza...)"
                />
                <input
                    type="password"
                    id="cerebrasKey"
                    placeholder="Cerebras API key (csk-...)"
                />
                <input
                    type="password"
                    id="groqKeyFallback"
                    placeholder="Groq API key (gsk_...)"
                />
                <button onclick="testFallbackLogic()">
                    Test Fallback Logic
                </button>
                <div
                    id="fallbackResult"
                    class="result"
                    style="display: none"
                ></div>
            </div>
        </div>

        <script>
            async function testGroqKey() {
                const apiKey = document
                    .getElementById("groqApiKey")
                    .value.trim();
                const result = document.getElementById("groqKeyResult");
                result.style.display = "block";
                result.className = "result";
                result.textContent = "Testing Groq API key...";

                if (!apiKey) {
                    result.className = "result error";
                    result.textContent = "Error: Please enter a Groq API key";
                    return;
                }

                if (!apiKey.startsWith("gsk_")) {
                    result.className = "result error";
                    result.textContent =
                        'Error: Groq API key should start with "gsk_"';
                    return;
                }

                try {
                    const response = await fetch(
                        "https://api.groq.com/openai/v1/chat/completions",
                        {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                Authorization: `Bearer ${apiKey}`,
                            },
                            body: JSON.stringify({
                                model: "llama-3.1-8b-instant",
                                messages: [{ role: "user", content: "Hello" }],
                                max_tokens: 10,
                            }),
                        }
                    );

                    if (response.ok) {
                        const data = await response.json();
                        result.className = "result success";
                        result.textContent = `‚úÖ Success!\n\nModel: ${data.model}\nResponse: ${data.choices[0].message.content}\nTokens: ${data.usage.total_tokens}`;
                    } else {
                        const error = await response.text();
                        result.className = "result error";
                        result.textContent = `‚ùå Error ${response.status}:\n${error}`;
                    }
                } catch (error) {
                    result.className = "result error";
                    result.textContent = `‚ùå Network Error:\n${error.message}`;
                }
            }

            async function testModelOrdering() {
                const result = document.getElementById("modelOrderResult");
                result.style.display = "block";
                result.className = "result success";

                const geminiModels = [
                    {
                        name: "gemini-2.5-pro",
                        provider: "gemini",
                        sizeCategory: "ultra",
                        effectiveSize: 1000,
                    },
                    {
                        name: "gemini-2.5-flash-preview-09-2025",
                        provider: "gemini",
                        sizeCategory: "large",
                        effectiveSize: 100,
                    },
                    {
                        name: "gemini-2.5-flash",
                        provider: "gemini",
                        sizeCategory: "large",
                        effectiveSize: 100,
                    },
                    {
                        name: "gemini-2.5-flash-image",
                        provider: "gemini",
                        sizeCategory: "medium",
                        effectiveSize: 50,
                    },
                    {
                        name: "gemini-2.0-flash",
                        provider: "gemini",
                        sizeCategory: "medium",
                        effectiveSize: 50,
                    },
                    {
                        name: "gemini-2.5-flash-lite-preview-09-2025",
                        provider: "gemini",
                        sizeCategory: "small",
                        effectiveSize: 10,
                    },
                    {
                        name: "gemini-2.5-flash-lite",
                        provider: "gemini",
                        sizeCategory: "small",
                        effectiveSize: 10,
                    },
                ];

                const cerebrasModels = [
                    {
                        name: "gpt-oss-120b",
                        provider: "cerebras",
                        paramCount: 120,
                    },
                    {
                        name: "llama-3.3-70b",
                        provider: "cerebras",
                        paramCount: 70,
                    },
                    {
                        name: "qwen-3-32b",
                        provider: "cerebras",
                        paramCount: 32,
                    },
                    {
                        name: "llama3.1-8b",
                        provider: "cerebras",
                        paramCount: 8,
                    },
                ];

                const groqModels = [
                    {
                        name: "openai/gpt-oss-120b",
                        provider: "groq",
                        paramCount: 120,
                    },
                    {
                        name: "llama-3.3-70b-versatile",
                        provider: "groq",
                        paramCount: 70,
                    },
                    {
                        name: "qwen/qwen3-32b",
                        provider: "groq",
                        paramCount: 32,
                    },
                    {
                        name: "openai/gpt-oss-20b",
                        provider: "groq",
                        paramCount: 20,
                    },
                    {
                        name: "llama-3.1-8b-instant",
                        provider: "groq",
                        paramCount: 8,
                    },
                ];

                const allModels = [
                    ...geminiModels,
                    ...cerebrasModels,
                    ...groqModels,
                ];

                const sizeOrder = {
                    ultra: 1000,
                    large: 100,
                    medium: 50,
                    small: 10,
                };
                allModels.sort((a, b) => {
                    const aSize =
                        a.paramCount || sizeOrder[a.sizeCategory] || 0;
                    const bSize =
                        b.paramCount || sizeOrder[b.sizeCategory] || 0;
                    return bSize - aSize;
                });

                let output =
                    "‚úÖ Model Fallback Order (Largest to Smallest):\n\n";
                allModels.forEach((model, idx) => {
                    const size = model.paramCount
                        ? `${model.paramCount}B`
                        : `${model.sizeCategory} (${
                              sizeOrder[model.sizeCategory]
                          })`;
                    output += `${idx + 1}. ${model.provider.toUpperCase()}: ${
                        model.name
                    } - ${size}\n`;
                });

                result.textContent = output;
            }

            async function testFallbackLogic() {
                const result = document.getElementById("fallbackResult");
                result.style.display = "block";
                result.className = "result";
                result.textContent = "Testing fallback logic...";

                const geminiKey = document
                    .getElementById("geminiKey")
                    .value.trim();
                const cerebrasKey = document
                    .getElementById("cerebrasKey")
                    .value.trim();
                const groqKey = document
                    .getElementById("groqKeyFallback")
                    .value.trim();

                let output = "üîÑ Fallback Configuration:\n\n";
                output += `Gemini API Key: ${
                    geminiKey ? "‚úÖ Configured" : "‚ùå Missing"
                }\n`;
                output += `Cerebras API Key: ${
                    cerebrasKey ? "‚úÖ Configured" : "‚ùå Missing"
                }\n`;
                output += `Groq API Key: ${
                    groqKey ? "‚úÖ Configured" : "‚ùå Missing"
                }\n\n`;

                if (!geminiKey && !cerebrasKey && !groqKey) {
                    result.className = "result error";
                    result.textContent =
                        "‚ùå Please configure at least one API key";
                    return;
                }

                output += "üìä Expected Fallback Sequence:\n";
                output +=
                    "The system will try models in size-descending order across ALL providers:\n";
                output += "1. Largest models from all providers first\n";
                output += "2. Then medium-sized models\n";
                output += "3. Finally smallest models\n\n";
                output +=
                    "This ensures maximum quality before falling back to faster/smaller models.";

                result.className = "result success";
                result.textContent = output;
            }
        </script>
    </body>
</html>
