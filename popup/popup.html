<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BookmarkMind</title>
  <link rel="stylesheet" href="popup.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z"
            fill="#4285f4" />
          <path d="M7 7H17V9H7V7ZM7 11H17V13H7V11ZM7 15H14V17H7V15Z" fill="#4285f4" />
        </svg>
        <h1>BookmarkMind</h1>
      </div>
      <button id="settingsBtn" class="icon-btn" title="Settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12 8C9.79 8 8 9.79 8 12C8 14.21 9.79 16 12 16C14.21 16 16 14.21 16 12C16 9.79 14.21 8 12 8ZM12 14C10.9 14 10 13.1 10 12C10 10.9 10.9 10 12 10C13.1 10 14 10.9 14 12C14 13.1 13.1 14 12 14Z"
            fill="currentColor" />
          <path
            d="M12 2C13.1 2 14 2.9 14 4C14 4.74 13.6 5.39 13 5.73V7.29C13 7.29 13 7.29 13 7.29C14.19 7.92 15.23 8.81 16.04 9.9L17.6 9.27C18.34 8.93 19.26 9.26 19.6 10C19.94 10.74 19.61 11.66 18.87 12L17.31 12.63C17.31 12.63 17.31 12.63 17.31 12.63C17.45 13.08 17.5 13.54 17.5 14C17.5 14.46 17.45 14.92 17.31 15.37L18.87 16C19.61 16.34 19.94 17.26 19.6 18C19.26 18.74 18.34 19.07 17.6 18.73L16.04 18.1C15.23 19.19 14.19 20.08 13 20.71V22.27C13 22.27 13 22.27 13 22.27C13.6 22.61 14 23.26 14 24C14 25.1 13.1 26 12 26C10.9 26 10 25.1 10 24C10 23.26 10.4 22.61 11 22.27V20.71C9.81 20.08 8.77 19.19 7.96 18.1L6.4 18.73C5.66 19.07 4.74 18.74 4.4 18C4.06 17.26 4.39 16.34 5.13 16L6.69 15.37C6.55 14.92 6.5 14.46 6.5 14C6.5 13.54 6.55 13.08 6.69 12.63L5.13 12C4.39 11.66 4.06 10.74 4.4 10C4.74 9.26 5.66 8.93 6.4 9.27L7.96 9.9C8.77 8.81 9.81 7.92 11 7.29V5.73C10.4 5.39 10 4.74 10 4C10 2.9 10.9 2 12 2Z"
            fill="currentColor" />
        </svg>
      </button>
    </div>

    <!-- Main Content -->
    <div class="content">
      <!-- Status Section -->
      <div id="statusSection" class="section">
        <div class="stats-grid">
          <div class="stat-item">
            <span class="stat-number" id="totalBookmarks">-</span>
            <span class="stat-label">Total Bookmarks</span>
          </div>
          <div class="stat-item">
            <span class="stat-number" id="uncategorized">-</span>
            <span class="stat-label">Uncategorized</span>
          </div>
        </div>

        <!-- Extension Status Indicator -->
        <div id="extensionStatus" class="extension-status">
          <span class="status-dot"></span>
          <span class="status-text">Loading...</span>
        </div>
      </div>

      <!-- API Key Warning -->
      <div id="apiKeyWarning" class="warning hidden">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z"
            fill="#ff9800" />
        </svg>
        <div>
          <strong>API Key Required</strong>
          <p>Please configure your Gemini API key in settings to start organizing bookmarks.</p>
        </div>
      </div>

      <!-- Action Section -->
      <div id="actionSection" class="section">
        <button id="sortBtn" class="primary-btn" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M3 18H9V16H3V18ZM3 6V8H21V6H3ZM3 13H15V11H3V13Z" fill="currentColor" />
          </svg>
          Sort Bookmarks Now
        </button>

        <button id="bulkCategorizeBtn" class="primary-btn bulk-btn" disabled>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor" />
          </svg>
          Bulk Categorize Selected
        </button>

        <div class="secondary-actions">
          <button id="viewSnapshotsBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20ZM12.5 7H11V13L16.25 16.15L17 14.92L12.5 12.25V7Z" fill="currentColor" />
            </svg>
            View Snapshots & Undo
          </button>
          <button id="deleteEmptyFoldersBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 19C6 20.1 6.9 21 8 21H16C17.1 21 18 20.1 18 19V7H6V19ZM19 4H15.5L14.5 3H9.5L8.5 4H5V6H19V4Z"
                fill="currentColor" />
            </svg>
            Delete Empty Folders
          </button>
          <button id="removeDuplicatesBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z"
                fill="currentColor" />
              <path d="M16 8L12 12L8 8" stroke="currentColor" stroke-width="2" fill="none" />
              <path d="M8 16L12 12L16 16" stroke="currentColor" stroke-width="2" fill="none" />
            </svg>
            Remove Duplicate URLs
          </button>
          <button id="moveToBookmarkBarBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 3L5 6.99H8V14H10V6.99H13L9 3ZM16 17.01V10H14V17.01H11L15 21L19 17.01H16Z"
                fill="currentColor" />
            </svg>
            Move All to Bookmark Bar
          </button>
          <button id="forceReorganizeBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M12 5V1L7 6L12 11V7C15.31 7 18 9.69 18 13C18 16.31 15.31 19 12 19C8.69 19 6 16.31 6 13H4C4 17.42 7.58 21 12 21C16.42 21 20 17.42 20 13C20 8.58 16.42 5 12 5Z"
                fill="currentColor" />
            </svg>
            Re-organize All
          </button>
          <button id="exportBtn" class="secondary-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.89 22 5.99 22H18C19.1 22 20 21.1 20 20V8L14 2ZM18 20H6V4H13V9H18V20Z"
                fill="currentColor" />
            </svg>
            Export Organization
          </button>
        </div>
      </div>

      <!-- Bulk Selection Section -->
      <div id="bulkSelectionSection" class="section hidden">
        <div class="bulk-header">
          <h3>Select Bookmarks to Categorize</h3>
          <div class="bulk-controls">
            <button id="selectAllBtn" class="control-btn">Select All</button>
            <button id="selectNoneBtn" class="control-btn">Select None</button>
            <button id="cancelBulkBtn" class="control-btn">Cancel</button>
          </div>
        </div>

        <div class="bookmark-search">
          <input type="text" id="bookmarkSearchInput" placeholder="Search bookmarks..." />
        </div>

        <div id="bookmarkList" class="bookmark-list">
          <!-- Bookmarks will be populated here -->
        </div>

        <div class="bulk-actions">
          <div class="selection-info">
            <span id="selectedCount">0</span> bookmarks selected
          </div>
          <button id="categorizeBulkBtn" class="primary-btn" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor" />
            </svg>
            Categorize Selected Bookmarks
          </button>
        </div>
      </div>

      <!-- Progress Section -->
      <div id="progressSection" class="section hidden">
        <div class="progress-container">
          <div class="progress-header">
            <span id="progressText">Preparing...</span>
            <span id="progressPercent">0%</span>
          </div>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="section hidden">
        <div class="results-container">
          <div class="result-icon success">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM10 17L5 12L6.41 10.59L10 14.17L17.59 6.58L19 8L10 17Z"
                fill="#4caf50" />
            </svg>
          </div>
          <h3 id="resultsTitle">Bookmarks Organized!</h3>
          <p id="resultsMessage">Your bookmarks have been successfully categorized.</p>
          <div class="results-stats">
            <div class="result-stat">
              <span id="processedCount">0</span>
              <span>Processed</span>
            </div>
            <div class="result-stat">
              <span id="categorizedCount">0</span>
              <span>Categorized</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Snapshots Section -->
      <div id="snapshotsSection" class="section hidden">
        <div class="snapshots-header">
          <h3>Bookmark Snapshots</h3>
          <button id="closeSnapshotsBtn" class="control-btn">Close</button>
        </div>

        <div class="storage-info" id="storageInfo">
          <span class="storage-label">Snapshots:</span>
          <span id="snapshotCount">0</span> /
          <span id="maxSnapshots">10</span>
          <span class="storage-size">(<span id="storageSize">0</span> MB)</span>
        </div>

        <div id="snapshotsList" class="snapshots-list">
          <!-- Snapshots will be populated here -->
        </div>

        <div class="snapshots-help">
          <p>ðŸ’¡ Snapshots are created automatically before AI categorization. You can restore any snapshot to undo changes.</p>
        </div>
      </div>

      <!-- Last Sort Info -->
      <div id="lastSortSection" class="section">
        <div class="last-sort-info">
          <span class="last-sort-label">Last organized:</span>
          <span id="lastSortTime">Never</span>
        </div>
      </div>

      <!-- Debug Section (hidden by default) -->
      <div id="debugSection" class="section hidden">
        <button id="debugBtn" class="secondary-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z"
              fill="currentColor" />
          </svg>
          Test Bookmark Access
        </button>
        <button id="testCategorizationBtn" class="secondary-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 16.17L4.83 12L3.41 13.41L9 19L21 7L19.59 5.59L9 16.17Z" fill="currentColor" />
          </svg>
          Test Categorization
        </button>
        <button id="testCommBtn" class="secondary-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM13 17H11V15H13V17ZM13 13H11V7H13V13Z"
              fill="currentColor" />
          </svg>
          Test Communication
        </button>
        <div id="debugResults" class="debug-results"></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <div class="footer-links">
        <a href="#" id="helpLink">Help</a>
        <a href="https://github.com/bookmarkmind/bookmarkmind" target="_blank">GitHub</a>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="../scripts/bookmarkService.js"></script>
  <script src="../scripts/aiProcessor.js"></script>
  <script src="../scripts/categorizer.js"></script>
  <script src="../scripts/folderManager.js"></script>
  <script src="../scripts/snapshotManager.js"></script>
  <script src="popup.js"></script>
</body>

</html>